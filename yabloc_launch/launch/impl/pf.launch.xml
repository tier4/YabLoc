<launch>

    <!-- predict update -->
    <arg name="input_initialpose" default="/initialpose3d"/>
    <arg name="twist_cov_for_prediction" default="/localization/twist_estimator/twist_with_covariance"/>
    <let name="inout_weighted_particles" value="weighted_particles"/>
    <let name="output_particles_marker_array" value="predicted_particles_marker"/>
    <node pkg="yabloc_particle_filter" exec="predictor_node" name="predictor_node" output="screen" args="--ros-args --log-level info">
        <param name="use_sim_time" value="$(var use_sim_time)"/>
        <param from="$(var predictor_param_path)"/>

        <remap from="twist_cov" to="$(var twist_cov_for_prediction)"/>
        <remap from="initialpose" to="$(var input_initialpose)" />

        <remap from="particles_marker_array" to="$(var output_particles_marker_array)"/>
        <remap from="height" to="/localization/yabloc/map/height"/>
        <remap from="pose_with_covariance" to="/localization/pose_estimator/pose_with_covariance"/>
    </node>

    <!-- camera  correction -->
    <arg name="input_projected_line_segments_cloud" default="/localization/yabloc/imgproc/projected_line_segments_cloud"/>
    <arg name="input_ll2_road_marking" default="/localization/yabloc/map/ll2_road_marking"/>
    <arg name="input_ll2_bounding_box" default="/localization/yabloc/map/ll2_bounding_box"/>
    <arg name="output_scored_cloud" default="scored_cloud"/>
    <arg name="output_cost_map_range" default="cost_map_range"/>
    <node pkg="yabloc_particle_filter" exec="camera_particle_corrector_node" name="camera_corrector" output="screen" args="--ros-args --log-level warn">
        <param name="use_sim_time" value="$(var use_sim_time)"/>
        <param from="$(var camera_particle_corrector_param_path)"/>

        <remap from="weighted_particles" to="$(var inout_weighted_particles)"/>
        <remap from="switch_srv" to="camera_corrector_switch"/>
        <remap from="line_segments_cloud" to="$(var input_projected_line_segments_cloud)"/>
        <remap from="ll2_road_marking" to="$(var input_ll2_road_marking)"/>
        <remap from="ll2_bounding_box" to="$(var input_ll2_bounding_box)"/>
        <remap from="scored_cloud" to="$(var output_scored_cloud)"/>
        <remap from="cost_map_range" to="$(var output_cost_map_range)"/>
    </node>

    <!-- gnss correction -->
    <node pkg="yabloc_particle_filter" exec="gnss_particle_corrector_node" name="gnss_corrector" output="screen" args="--ros-args --log-level warn">
        <param name="use_sim_time" value="$(var use_sim_time)"/>
        <param from="$(var gnss_particle_corrector_param_path)"/>

        <remap from="input/navpvt" to="/sensing/gnss/ublox/navpvt"/>
        <remap from="input/height" to="/localization/yabloc/map/height"/>
        <remap from="input/pose_with_covariance" to="/sensing/gnss/pose_with_covariance"/>

        <remap from="weighted_particles" to="$(var inout_weighted_particles)"/>
        <remap from="gnss_range_marker" to="/localization/pf/gnss_range_marker"/>
    </node>
</launch>

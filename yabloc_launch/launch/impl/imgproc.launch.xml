<launch>
    <arg name="src_image" default="/sensing/camera/traffic_light/image_raw/compressed"/>
    <arg name="src_info" default="/sensing/camera/traffic_light/camera_info"/>
    <arg name="resized_image" default="/sensing/camera/undistorted/image_raw/relay"/>
    <arg name="resized_info" default="/sensing/camera/undistorted/camera_info"/>
    <arg name="override_camera_frame_id" default="" description="Value for overriding the camera's frame_id. 
        Use when another static_tf is to be read
        if it is blank (default) camera frame_id is not overridden."/>

    <!-- undistort -->
    <node name="undistort" pkg="undistort" exec="undistort_node" output="screen" args="--ros-args --log-level warn">
        <param name="use_sim_time" value="$(var use_sim_time)"/>
        <param name="override_frame_id" value="$(var override_camera_frame_id)"/>
        <param from="$(var undistort_param_path)"/>

        <remap from="src_image" to="$(var src_image)"/>
        <remap from="src_info" to="$(var src_info)"/>
        <remap from="resized_image" to="$(var resized_image)"/>
        <remap from="resized_info" to="$(var resized_info)"/>
    </node>

    <!-- line segment detector -->
    <arg name="output_image_with_line_segments" default="image_with_line_segments"/>
    <arg name="output_line_segments_cloud" default="line_segments_cloud"/>
    <node name="lsd" pkg="lsd" exec="lsd_node" output="screen" args="--ros-args --log-level warn">
        <param name="use_sim_time" value="$(var use_sim_time)"/>
        <remap from="src_image" to="$(var resized_image)"/>

        <remap from="image_with_line_segments" to="$(var output_image_with_line_segments)"/>
        <remap from="line_segments_cloud" to="$(var output_line_segments_cloud)"/>
    </node>

    <!-- graph based segmentation -->
    <arg name="output_graph_segmented" default="graph_segmented"/>
    <arg name="output_segmented_image" default="segmented_image"/>
    <node name="graph_segment" pkg="graph_segment" exec="graph_segment_node" output="screen" args="--ros-args --log-level warn">
        <param name="use_sim_time" value="$(var use_sim_time)"/>
        <param from="$(var graph_segment_param_path)"/>

        <remap from="src_image" to="$(var resized_image)"/>
        <remap from="graph_segmented" to="$(var output_graph_segmented)"/>
        <remap from="segmented_image" to="$(var output_segmented_image)"/>
    </node>

    <!-- segment fitler -->
    <arg name="input_graph_segmented" default="graph_segmented"/>
    <arg name="input_line_segments_cloud" default="line_segments_cloud"/>
    <arg name="output_projected_line_segments_cloud" default="/localization/yabloc/imgproc/projected_line_segments_cloud"/>
    <arg name="output_projected_image" default="/localization/yabloc/imgproc/projected_image"/>
    <arg name="output_debug_image_with_lines" default="debug/projected_image"/>
    <node name="segment_filter" pkg="segment_filter" exec="segment_filter_node" output="screen" args="--ros-args --log-level info">
        <param name="use_sim_time" value="$(var use_sim_time)"/>
        <param from="$(var segment_filter_param_path)"/>

        <remap from="undistorted_image" to="$(var resized_image)"/>
        <remap from="camera_info" to="$(var resized_info)"/>
        <remap from="graph_segmented" to="$(var input_graph_segmented)"/>
        <remap from="line_segments_cloud" to="$(var input_line_segments_cloud)"/>
        <remap from="projected_line_segments_cloud" to="$(var output_projected_line_segments_cloud)"/>
        <remap from="projected_image" to="$(var output_projected_image)"/>
        <remap from="debug/image_with_lines" to="$(var output_debug_image_with_lines)"/>
    </node>

</launch>